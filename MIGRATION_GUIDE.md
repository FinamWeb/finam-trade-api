# Руководство по миграции на новый Finam Trade API

Это руководство поможет вам перейти со старой версии Trade API на новую. Новый API предлагает более логичную и последовательную структуру, расширенный функционал и улучшенную производительность.

## Ключевые концептуальные изменения

Перед тем как перейти к детальному сопоставлению методов, ознакомьтесь с ключевыми изменениями в архитектуре API:

1.  **Реорганизация сервисов**: Функциональность была перегруппирована в логические сервисы. Например, методы для получения информации об инструментах и рыночных данных теперь находятся в разных сервисах (`AssetsService` и `MarketDataService`).
2.  **Портфель → Счет (`Portfolio` → `Account`)**: Концепция "портфеля" была заменена на "счет". Все операции, связанные с получением информации о позициях, деньгах и сделках пользователя, теперь выполняются через `AccountsService`.
3.  **Единый сервис заявок**: Сервисы `Orders` и `Stops` были объединены в один `OrdersService`. Теперь и лимитные, и стоп-заявки управляются через одни и те же методы. Тип заявки указывается в теле запроса.
4.  **Гранулярные подписки на события**: Вместо единого стриминг-метода `Events.GetEvents` новый API предоставляет отдельные методы для подписки на конкретные типы данных:
    *   `MarketDataService`: подписки на котировки, стаканы, сделки по инструментам и свечи.
    *   `OrdersService`: подписка на события по вашим собственным заявкам и сделкам.
5.  **Выделенный сервис аутентификации**: Появился новый сервис `AuthService`, отвечающий за управление токенами доступа.

---

## Таблица сопоставления методов

В таблице ниже показано, какие методы нового API заменяют методы старого API.

| Старый сервис | Старый метод | Новый сервис | Новый метод | Примечания |
| :--- | :--- | :--- | :--- | :--- |
| `Candles` | `GetDayCandles` | `MarketDataService` | `Bars` | Метод `Bars` заменяет оба старых метода. Таймфрейм (дневной, часовой и т.д.) теперь задается в параметре `timeframe`. |
| `Candles` | `GetIntradayCandles` | `MarketDataService` | `Bars` | Аналогично `GetDayCandles`. Укажите нужный таймфрейм в запросе. |
| `Orders` | `NewOrder` | `OrdersService` | `PlaceOrder` | Функциональность сохранена. Проверьте изменения в полях запроса `Order`. |
| `Orders` | `CancelOrder` | `OrdersService` | `CancelOrder` | Логика осталась прежней. |
| `Orders` | `GetOrders` | `OrdersService` | `GetOrders` | Возвращает список активных заявок для счета. |
| `Stops` | `NewStop` | `OrdersService` | `PlaceOrder` | Стоп-заявки теперь выставляются через общий метод `PlaceOrder` с указанием типа заявки (`ORDER_TYPE_STOP` или `ORDER_TYPE_STOP_LIMIT`). |
| `Stops` | `CancelStop` | `OrdersService` | `CancelOrder` | Отмена стоп-заявки теперь выполняется стандартным методом отмены. |
| `Stops` | `GetStops` | `OrdersService` | `GetOrders` | Метод `GetOrders` возвращает все типы заявок, включая стоп-заявки. |
| `Portfolios` | `GetPortfolio` | `AccountsService` | `GetAccount` | Запрашивает информацию по конкретному счету, включая позиции и доступные средства. |
| `Securities` | `GetSecurities` | `AssetsService` | `Assets` | Возвращает полный список доступных для торговли инструментов. |
| `Events` | `GetEvents` | `MarketDataService` / `OrdersService` | `SubscribeQuote`, `SubscribeOrderBook`, `SubscribeLatestTrades`, `SubscribeBars`, `SubscribeOrderTrade` | Единый поток событий разделен на несколько специализированных стриминг-методов. Выберите тот, который соответствует нужным вам данным. |

---

## Пример миграции: Получение свечей

**Старый API:**

Вам нужно было вызывать два разных метода для дневных и внутридневных свечей.

```protobuf
// Запрос дневных свечей
rpc GetDayCandles(GetDayCandlesRequest) returns (GetDayCandlesResult);

// Запрос внутридневных свечей
rpc GetIntradayCandles(GetIntradayCandlesRequest) returns (GetIntradayCandlesResult);
```

**Новый API:**

Теперь используется один метод `Bars`, а нужный временной интервал указывается в параметре `timeframe`.

```protobuf
// Запрос свечей с указанием таймфрейма
rpc Bars(BarsRequest) returns (BarsResponse);

message BarsRequest {
  string symbol = 1;
  TimeFrame timeframe = 2; // e.g., TIME_FRAME_D for daily, TIME_FRAME_H1 for hourly
  google.type.Interval interval = 3;
}
```

## Заключение

Миграция на новый API требует внимательного изучения новой структуры сервисов и моделей данных. Рекомендуем вам ознакомиться с proto-файлами в директории `finam-trade-api-main/proto`, чтобы понять все возможности нового API. Этот переход позволит вам использовать более гибкий и мощный инструмент для создания ваших торговых приложений.

## Контакты
Официальный сайт TradeAPI https://tradeapi.finam.ru/.

Чтобы задать вопрос или сообщить о проблеме, напишите, пожалуйста, в наш официальный чат поддержки, находится в "Контакты" -> "Чат на сайте"